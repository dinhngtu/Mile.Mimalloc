From bf5bc607c6c04f6de6bb42985f84ea5c63b4b2b2 Mon Sep 17 00:00:00 2001
From: Tu Dinh <contact@tudinh.xyz>
Date: Sun, 5 Oct 2025 04:38:57 +0200
Subject: [PATCH] Fix cross build

Signed-off-by: Tu Dinh <contact@tudinh.xyz>
---
 CMakeLists.txt | 8 +++++---
 1 file changed, 5 insertions(+), 3 deletions(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index bb3682c4..2b91d86c 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -124,12 +124,14 @@ endif()
 # Determine architecture
 set(MI_OPT_ARCH_FLAGS "")
 set(MI_ARCH "unknown")
-if(CMAKE_SYSTEM_PROCESSOR MATCHES "^(x86|i[3456]86)$" OR CMAKE_GENERATOR_PLATFORM MATCHES "^(x86|Win32)$")
+if(CMAKE_GENERATOR_PLATFORM MATCHES "^(x86|Win32)$")
   set(MI_ARCH "x86")
-elseif(CMAKE_SYSTEM_PROCESSOR MATCHES "^(x86_64|x64|amd64|AMD64)$" OR CMAKE_GENERATOR_PLATFORM STREQUAL "x64" OR "x86_64" IN_LIST CMAKE_OSX_ARCHITECTURES) # must be before arm64
+elseif(CMAKE_GENERATOR_PLATFORM STREQUAL "x64" OR "x86_64" IN_LIST CMAKE_OSX_ARCHITECTURES) # must be before arm64
   set(MI_ARCH "x64")
-elseif(CMAKE_SYSTEM_PROCESSOR MATCHES "^(aarch64|arm64|armv[89].?|ARM64)$" OR CMAKE_GENERATOR_PLATFORM STREQUAL "ARM64" OR "arm64" IN_LIST CMAKE_OSX_ARCHITECTURES)
+elseif(CMAKE_GENERATOR_PLATFORM STREQUAL "ARM64" OR "arm64" IN_LIST CMAKE_OSX_ARCHITECTURES)
   set(MI_ARCH "arm64")
+elseif(DEFINED CMAKE_GENERATOR_PLATFORM)
+  set(MI_ARCH ${CMAKE_GENERATOR_PLATFORM})
 elseif(CMAKE_SYSTEM_PROCESSOR MATCHES "^(arm|armv[34567].?|ARM)$")
   set(MI_ARCH "arm32")
 elseif(CMAKE_SYSTEM_PROCESSOR MATCHES "^(riscv|riscv32|riscv64)$")
-- 
2.51.0.windows.1

